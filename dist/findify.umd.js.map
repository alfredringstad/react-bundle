{"version":3,"file":"findify.umd.js","sources":["../index.js"],"sourcesContent":["import { useRef, useEffect, useState } from 'react';\nimport { useHistory } from \"react-router-dom\";\n\nconst eventBindings = {\n  autocomplete: 'change:suggestions',\n  recommendation: 'change:items',\n  search: 'change:items',\n}\n\nconst randomKey = () => Math.random().toString(36).substring(7)\n\n\nconst waitForFindify = () => new Promise(resolve =>\n  (window.findifyCallbacks = window.findifyCallbacks || []).push(findify => resolve(findify))\n);\n\nconst getWidgetConfig = (type, node, config, customs) => {\n  const cfg = type === 'recommendation'\n    && config.getIn(['features', 'recommendations', '#' + node.getAttribute('id')])\n    || config.getIn(['features', type]);\n\n  return config.withMutations(c =>\n      c.mergeDeep(cfg)\n      .mergeDeep(customs)\n      .set('node', node)\n      .set('cssSelector', `findify-${type} findify-widget-${customs.widgetKey}`)\n      .toJS()\n    );\n};\n\nexport default ({ type, config = {}, options = {}, widgetKey = randomKey() }) => {\n  const container = useRef(null);\n  const [ready, setReady] = useState(false);\n  const history = useHistory();\n\n  useEffect(() => {\n    if (!container.current) return;\n    let findify = void 0;\n    \n    (async () => {\n      findify = await waitForFindify();\n      findify.history = history;\n    \n      const widgetConfig = getWidgetConfig(\n        type,\n        container.current,\n        findify.config,\n        { ...config, widgetKey, disableAutoRequest: true }\n      );\n    \n      findify.widgets.attach(container.current, type, widgetConfig)\n\n      const widget = findify.widgets.get(widgetKey)\n\n      const meta = widget.config.get('meta') && widget.config.get('meta').toJS() || {};\n      widget.agent.defaults({ ...meta, ...options }).once(eventBindings[type], () => setReady(true))\n\n      if (['search', 'smart-collection'].includes(type)) {\n        widget.agent.applyState(findify.utils.getQuery())\n      }\n      \n    })()\n\n    return () => {\n      if (!findify) return (shouldRender = false)\n      findify.widgets.detach(widgetKey)\n    }\n  }, [container]);\n\n  return [container, ready];\n}\n"],"names":["eventBindings","autocomplete","recommendation","search","type","config","options","widgetKey","Math","random","toString","substring","container","useRef","useState","ready","setReady","history","useHistory","useEffect","current","findify","Promise","resolve","window","findifyCallbacks","push","widgetConfig","node","customs","cfg","getIn","getAttribute","withMutations","c","mergeDeep","set","toJS","getWidgetConfig","disableAutoRequest","widgets","attach","widget","get","meta","agent","defaults","once","includes","applyState","utils","getQuery","shouldRender","detach"],"mappings":"6gBAGA,IAAMA,EAAgB,CACpBC,aAAc,qBACdC,eAAgB,eAChBC,OAAQ,uCAwBQC,IAAAA,SAAMC,OAAAA,aAAS,SAAIC,QAAAA,aAAU,SAAIC,UAAAA,aArB3BC,KAAKC,SAASC,SAAS,IAAIC,UAAU,KAsBrDC,EAAYC,SAAO,QACCC,YAAS,GAA5BC,OAAOC,OACRC,EAAUC,eAoChB,OAlCAC,YAAU,WACR,GAAKP,EAAUQ,QAAf,CACA,IAAIC,OAAU,EAFA,+BAvBeC,QAAQ,SAAAC,UACtCC,OAAOC,iBAAmBD,OAAOC,kBAAoB,IAAIC,KAAK,SAAAL,UAAWE,EAAQF,0BA2B9EA,KACQJ,QAAUA,EAElB,IAAMU,EA3BY,SAACvB,EAAMwB,EAAMvB,EAAQwB,GAC3C,IAAMC,EAAe,mBAAT1B,GACPC,EAAO0B,MAAM,CAAC,WAAY,kBAAmB,IAAMH,EAAKI,aAAa,SACrE3B,EAAO0B,MAAM,CAAC,WAAY3B,IAE/B,OAAOC,EAAO4B,cAAc,SAAAC,UACxBA,EAAEC,UAAUL,GACXK,UAAUN,GACVO,IAAI,OAAQR,GACZQ,IAAI,yBAA0BhC,qBAAuByB,EAAQtB,WAC7D8B,SAiBoBC,CACnBlC,EACAQ,EAAUQ,QACVC,EAAQhB,YACHA,GAAQE,UAAAA,EAAWgC,oBAAoB,KAG9ClB,EAAQmB,QAAQC,OAAO7B,EAAUQ,QAAShB,EAAMuB,GAEhD,IAAMe,EAASrB,EAAQmB,QAAQG,IAAIpC,GAE7BqC,EAAOF,EAAOrC,OAAOsC,IAAI,SAAWD,EAAOrC,OAAOsC,IAAI,QAAQN,QAAU,GAC9EK,EAAOG,MAAMC,cAAcF,EAAStC,IAAWyC,KAAK/C,EAAcI,GAAO,kBAAMY,GAAS,KAEpF,CAAC,SAAU,oBAAoBgC,SAAS5C,IAC1CsC,EAAOG,MAAMI,WAAW5B,EAAQ6B,MAAMC,cAvB5B,2BA4Bd,kBACE,IAAK9B,EAAS,OAAQ+B,cAAe,EACrC/B,EAAQmB,QAAQa,OAAO9C,MAExB,CAACK,IAEG,CAACA,EAAWG"}