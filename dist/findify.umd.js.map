{"version":3,"file":"findify.umd.js","sources":["../index.js"],"sourcesContent":["import { useRef, useEffect, useState } from 'react';\nimport { useHistory } from \"react-router-dom\";\n\nconst eventBindings = {\n  autocomplete: 'change:suggestions',\n  recommendation: 'change:items',\n  search: 'change:items',\n}\n\nconst randomKey = () => Math.random().toString(36).substring(7)\n\n\nconst waitForFindify = () => new Promise(resolve =>\n  (window.findifyCallbacks = window.findifyCallbacks || []).push(findify => resolve(findify))\n);\n\nconst getWidgetConfig = (type, node, config, customs) => {\n  const cfg = type === 'recommendation'\n    && config.getIn(['features', 'recommendations', '#' + node.getAttribute('id')])\n    || config.getIn(['features', type]);\n\n  return config.withMutations(c =>\n      c.mergeDeep(cfg)\n      .mergeDeep(customs)\n      .set('node', node)\n      .set('cssSelector', `findify-${type} findify-widget-${customs.widgetKey}`)\n      .toJS()\n    );\n};\n\nexport default ({ type, config = {}, options = {}, widgetKey = randomKey() }) => {\n  const container = useRef(null);\n  const [ready, setReady] = useState(false);\n  const history = useHistory();\n\n  useEffect(() => {\n    if (!container.current) return;\n    let findify = void 0;\n    \n    const init = async () => {\n      findify = await waitForFindify();\n      findify.history = history;\n    \n      const widgetConfig = getWidgetConfig(\n        type,\n        container.current,\n        findify.config,\n        { ...config, widgetKey, disableAutoRequest: true }\n      );\n    \n      findify.widgets.attach(container.current, type, widgetConfig)\n\n      const widget = findify.widgets.get(widgetKey)\n\n      const meta = widget.config.get('meta') && widget.config.get('meta').toJS() || {};\n      widget.agent.defaults({ ...meta, ...options }).once(eventBindings[type], () => setReady(true))\n\n      if (['search', 'smart-collection'].includes(type)) {\n        widget.agent.applyState(findify.utils.getQuery())\n      }  \n    }\n\n    init();\n\n    return () => {\n      findify.widgets.detach(widgetKey)\n    }\n  }, [container]);\n\n  return [container, ready];\n}\n"],"names":["eventBindings","autocomplete","recommendation","search","randomKey","Math","random","toString","substring","waitForFindify","Promise","resolve","window","findifyCallbacks","push","findify","getWidgetConfig","type","node","config","customs","cfg","getIn","getAttribute","withMutations","c","mergeDeep","set","widgetKey","toJS","options","container","useRef","useState","ready","setReady","history","useHistory","useEffect","current","init","widgetConfig","disableAutoRequest","widgets","attach","widget","get","meta","agent","defaults","once","includes","applyState","utils","getQuery","detach"],"mappings":"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"}