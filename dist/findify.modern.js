import{useRef as t,useState as e,useEffect as n}from"react";function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}const r={autocomplete:"change:suggestions",recommendation:"change:items",search:"change:items","smart-collection":"change:items"},i=()=>Math.random().toString(36).substring(7),s=()=>new Promise(t=>(window.findifyCallbacks=window.findifyCallbacks||[]).push(e=>t(e)));export default({type:a,config:c={},options:l={},history:g,widgetKey:u=i()})=>{const m=t(null),[d,f]=e(!1),[h,p]=e(!1);return n(()=>{if(!m.current)return;let t,e=!0;return(async()=>{if(t=await s(),!e)return;g&&(t.utils.history=g);const n=((t,e,n,o)=>"recommendation"!==t?o:n.getIn(["features","recommendations","#"+(o.slot||e.getAttribute("id"))]).mergeDeep(o))(a,m.current,t.config,o({widgetKey:u,disableAutoRequest:!0},c));t.widgets.attach(m.current,"smart-collection"===a?"search":a,n);const i=t.widgets.get(u),d=o({},i.config.get("meta")&&i.config.get("meta").toJS()||{},l);"recommendation"===a&&(d.slot=c.slot,d.type=c.type||n.get("type")),"smart-collection"===a&&(d.slot=c.slot||t.utils.collectionPath());const h=t=>window.requestAnimationFrame(()=>{i.agent.off(h),t.size||p(!0),f(!0)});i.agent.defaults(d).on("error",()=>p(!0)).on(r[a],h),["search","smart-collection"].includes(a)&&i.agent.applyState(t.utils.getQuery())})(),()=>{console.log("detach",u),t?t.widgets.detach(u):e=!1}},[m]),[m,d,h]};export{s as waitForFindify};
//# sourceMappingURL=findify.modern.js.map
